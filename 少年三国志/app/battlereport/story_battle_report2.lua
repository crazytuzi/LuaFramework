local report = {	
    ["tp"] = 2,	
    ["result"] = {	
        ["left_own_teams"] = {	
            ["units"] = {	
                [1] = {	
                    ["anger"] = 3,	
                    ["hp"] = 436,	
                    ["position"] = 0,	
                    ["id"] = 1,	
                },	
                [2] = {	
                    ["anger"] = 2,	
                    ["hp"] = 1478,	
                    ["position"] = 1,	
                    ["id"] = 10070,	
                },	
                [3] = {	
                    ["anger"] = 0,	
                    ["hp"] = 1973,	
                    ["position"] = 2,	
                    ["id"] = 10004,	
                },	
            },	
        },	
    },	
    ["bouts"] = {	
        [1] = {	
            ["own_team"] = 0,	
            ["rounds"] = {	
                [1] = {	
                    ["attacks"] = {	
                        [1] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 1,	
                            ["position"] = 0,	
                            ["anger"] = 3,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 145,	
                                },	
                            },	
                        },	
                        [2] = {	
                            ["identity"] = 2,	
                            ["skill_id"] = 3,	
                            ["position"] = 0,	
                            ["anger"] = 3,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 431,	
                                },	
                            },	
                        },	
                        [3] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 100672,	
                            ["position"] = 1,	
                            ["anger_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 1,	
                                    ["anger"] = 2,	
                                },	
                            },	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 897,	
                                },	
                                [2] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 885,	
                                },	
                                [3] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 2,	
                                    ["change_hp"] = 878,	
                                },	
                            },	
                            ["anger"] = 2,	
                        },	
                        [4] = {	
                            ["identity"] = 2,	
                            ["skill_id"] = 401552,	
                            ["position"] = 1,	
                            ["anger"] = 0,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 1124,	
                                },	
                                [2] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 1138,	
                                },	
                                [3] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 2,	
                                    ["change_hp"] = 1033,	
                                },	
                            },	
                        },	
                        [5] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 100014,	
                            ["position"] = 2,	
                            ["anger"] = 0,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = false,	
                                    ["identity"] = 2,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 1419,	
                                },	
                                [2] = {	
                                    ["state"] = false,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 1376,	
                                },	
                                [3] = {	
                                    ["state"] = false,	
                                    ["identity"] = 2,	
                                    ["position"] = 2,	
                                    ["change_hp"] = 1419,	
                                },	
                            },	
                            ["unite_index"] = {	
                                [1] = 1,	
                            },	
                        },	
                    },	
                },	
            },	
            ["enemy_team"] = 0,	
        },	
    },	
    ["is_win"] = true,	
    ["own_name"] = "zb2",	
    ["enemy_teams"] = {	
        [1] = {	
            ["units"] = {	
                [1] = {	
                    ["anger"] = 1,	
                    ["hp"] = 1000,	
                    ["position"] = 0,	
                    ["id"] = 9502,	
                },	
                [2] = {	
                    ["anger"] = 4,	
                    ["hp"] = 1200,	
                    ["position"] = 1,	
                    ["id"] = 9504,	
                },	
                [3] = {	
                    ["anger"] = 1,	
                    ["hp"] = 1000,	
                    ["position"] = 2,	
                    ["id"] = 9503,	
                },	
            },	
        },	
    },	
    ["own_teams"] = {	
        [1] = {	
            ["units"] = {	
                [1] = {	
                    ["position"] = 0,	
                    ["anger"] = 1,	
                    ["hp"] = 1560,	
                    ["id"] = 1,	
                    ["dress_id"] = 0,	
                },	
                [2] = {	
                    ["position"] = 1,	
                    ["anger"] = 4,	
                    ["hp"] = 2616,	
                    ["id"] = 10070,	
                    ["dress_id"] = 0,
                    ["name"] = G_lang:get("LANG_REPORT_NAME_GUOJIA"),
                },	
                [3] = {	
                    ["position"] = 2,	
                    ["anger"] = 4,	
                    ["hp"] = 3006,	
                    ["id"] = 10004,	
                    ["dress_id"] = 0,
                    ["name"] = G_lang:get("LANG_REPORT_NAME_CAOCAO"),
                },	
            },	
        },	
    },	
}

require "app.cfg.knight_info"

report.own_name = G_Me.userData.name

-- 先登记当前战报中默认选中的主角的技能
local mainKnight = knight_info.get(report.own_teams[1].units[1].id)

local skills = {
    common_id = mainKnight.common_id,
    active_skill_id = mainKnight.active_skill_id
}

-- 更换主角id
local _, baseId = G_Me.formationData:getTeamKnightIdAndBaseIdByIndex(1, 1)

if baseId ~= report.own_teams[1].units[1].id then

    -- 上阵阵容的主角
    report.own_teams[1].units[1].id = baseId

    -- 剩余人数的主角
    report.result.left_own_teams.units[1].id = baseId

    -- 遍历战报，更换技能
    for i=1, #report.bouts do
        local bout = report.bouts[i]
        for j=1, #bout.rounds do
            local round = bout.rounds[j]
            for s=1, #round.attacks do
                local attack = round.attacks[s]
                -- 主角的出手
                if attack.identity == 1 and attack.position == 0 then
                    -- 普通技能
                    if attack.skill_id == skills.common_id then
                        attack.skill_id = knight_info.get(baseId).common_id
                    -- 主动技能
                    elseif attack.skill_id == skills.active_skill_id then
                        attack.skill_id = knight_info.get(baseId).active_skill_id
                    else
                        assert(false, "Unknown skill with skill_id: "..attack.skill_id)
                    end
                end
            end
        end
    end

end

return report
